# Функции
Во введении автор приводит в качестве примера функцию из FitNesse и затем показывает, как ее можно улучшить путем выделения нескольких методов, переименований и реструктуризацией.

## Компактность!
**Первое правило: функции должны быть компактными.**
**Второе правило:** *функции должны быть еще компактнее.*

Желательно, чтобы длина функции не превышала *20* строк.

### Блоки и отступы
Автор настаивает, что блоки `if/while/etc` должны состоять только из одной строки -- строки вызова функции.

Также функции не должны содержать вложенные структуры. Максимальные уровень отступов в функции не должен превышать *одного-двух*. Это упрощает чтение и понимание.

## Правило одной операции
**Функция должна выполнять ТОЛЬКО одну операцию и ничего более.**

### Секции в функциях
Функция, выполняющая только одну операцию, невозможно осмысленно разделить на секции (объявления, инициализация, отбор...)

## Один уровень абстракции на функцию
Команды функции должны находится на одном уровне абстракции.

Например, различные уровни абстракций:
* getHtml() -- высокий уровень
* String pagePathName = PathParser.render(pagePath) -- средний
* .append("\n") -- чрезвычайно низкий

### Чтение кода сверху вниз: правило понижения
**Код должен читаться как рассказ -- сверху вниз**.

## Команды switch
Для решения проблемы больших switch'ей, автор предлагает использование полиморфизма и GoF паттернов, а именно абстрактную фабрику.

## Используйте содержательные имена
Хорошие имена функций -- половина успеха.

Не бойтесь длинных имен функций. Они лучше коротких и невразумительных.

## Аргументы функций
Идеально: ноль аргументов.
Нормально: один-два аргумента.
Лучше избегать: три аргумента.
Лучше не использовать: более трех.

### Стандартные унарные формы
Существуют два распространенных случая унарных функций:
* Проверка некоторого условия (`fileExists("myfile")`)
* Обработка аргумента, его преобразование и возвращение (`InputStream fileOpen("myfile")`)

Менее распространенные:
* События (`void`, без изменения входящих аргументов)

Лучше не использовать изменение входящих аргументов (даже если это просто возврат этого же значения):
```java
// Плохо:
void transform(StringBuffer out)


// Хорошо:
StringBuffer transform(StringBuffer in)
```

### Аргументы-флаги
Использовать их плохо, лучше разбить на две функции.

### Бинарные функции
`Point p = new Point(0, 0);` -- разумный выбор: точка естественным образом создается с двумя параметрами. Это упорядоченные компоненты одного значения.

`writeField(outputStream, name)` -- плохо, нет естественной связи и естественного порядка.

Выход: вызывать как `outputStream.writeField(name)` или сделать `outputStream` членом текущего класса.

### Тернарные функции
Хорошо подумайте, используйте с умом.

### Объекты как аргументы
```java
Circle makeCircle(double x, double y, double radius);

// Лучше:
Circle makeCircle(Point center, double radius);
```

### Списки аргументов
Использовать неопределенное количество аргументов -- нормально (функция `format` посчитаем бинарной).

### Глаголы и ключевые слова
```java
write(name);

// Лучше:
writeField(name);
```

## Избавьтесь от побочных эффектов
Они портят чистый код.

### Выходные аргументы
Вызов `appendFooter(s)` неочевиден и заставит посмотреть на сигнатуру. Лучший вариант: `report.appendFooter()`.

## Разделение команд и запросов
```java
// Не очень:
if (set("username", "unclebob")) { ... }

// Лучше:
if (attributeExists("username")) {
  setAttribute("unclebob");
  ...
}
```

## Используйте исключения вместо возвращения кодов ошибок
Автор использует Java и советует избегать следующей от этого глубокой вложенности кода.

### Изолируйте блоки try/catch
Выносим обработку ошибок в отдельные функции.

### Обработка ошибок как одна операция
Функции, которые обрабатывают ошибки, должны делать только это.

### enum Error
В Java (и не только) автор рекомендует не использовать Error как перечисление (т.н. "магнит зависимостей") и вместо них использовать исключения (и их производные).

Аргументирует, например, повторной перекомпиляцией всего.

## Не повторяйтесь
Дублирование кода может принести много проблем.

## Структурное программирование
Не смотря на правила структурного программирования Дейкстры, авторы книги не видят во множественных `return`, командах `break` и `continue` ничего плохо и иногда они могут повысить выразительность кода.

Но `goto` лучше избегать.

## Как научиться писать такие функции?
1. Пишите функции
2. "Причесываете" ее: выделяете новые функции, изменяете имена, устраняете дубликаты