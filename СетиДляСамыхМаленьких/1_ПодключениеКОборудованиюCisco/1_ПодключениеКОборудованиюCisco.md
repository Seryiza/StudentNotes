# Подключение к оборудованию Cisco

В курсе предполагается использование программы для моделирования сети. К наиболее популярным можно отнести:

* Cisco Packet Tracer
* GNS3

Далее автор будет использовать CPT.

## Способы подключения
* [CPT Only] CLI в окне управления
* Терминальное подключение с рабочей станции через консольный кабель
* telnet / ssh
* Web-интерфейс (Cisco SDM) (лучше не надо)

## Пользовательский и привилегированный режим
`Router>`

Это стандартное совершенно для любой линейки cisco приглашение, которое характеризует **пользовательский режим**, в котором можно просматривать некоторую статистику и проводить самые простые операции вроде пинга. Ввод **знака вопроса** покажет список доступных команд.

Грубо говоря, это режим для сетевого оператора, инженера первой линии техподдержки, чтобы он ничего там не повредил, не напортачил и лишнего не узнал.

Гораздо большие возможности предоставляет режим с говорящим названием **привилегированный**. Попасть в него можно, введя команду
`>enable`

Теперь приглашение выглядит так:
`Router#`

Команда `#show running-config` отображает текущую конфигурацию устройства.

## Сокращение команд
Все команды в консоли можно сокращать. Главное, чтобы сокращение однозначно указывало на команду. Например, `show running-config` сокращается до `sh run`. Меньше нельзя, ибо возникнет неоднозначность с другими командами.

По нажатию `Tab` сокращенная команда дописывается до полной, а знак вопроса, следующий за командой, выводит список дальнейших возможностей и небольшую справку по ним.

## Горячие клавишы
`Ctrl+A` — Передвинуть курсор на начало строки
`Ctrl+E` — Передвинуть курсор на конец строки
`Курсорные Up, Down` — Перемещение по истории команд
`Ctrl+W` — Стереть предыдущее слово
`Ctrl+U` — Стереть всю линию
`Ctrl+C` — Выход из режима конфигурирования
`Ctrl+Z` — Применить текущую команду и выйти из режима конфигурирования
`Ctrl+Shift+6` — Остановка длительных процессов (так называемый escape sequence)

## Фильтры
Используйте **фильтрацию вывода команды**. Облегчаем работу с помощью фильтрации: после команды ставим `|`, пишем вид фильтрации и, собственно, искомое слово (или его часть). Виды фильтрации (ака модификаторы вывода):

* `begin` — вывод всех строк, начиная с той, где нашлось слово,
* `section` — вывод секций конфигурационного файла, в которых встречается слово,
* `include` — вывод строк, где встречается слово,
* `exclude` — вывод строк, где НЕ встречается слово.

## Режим глобальной конфигурации
Включается командой `# configure terminal` и меняет приглашение на `Router(config)#`.

## Команда do
Есть полезная штука, как `do`. Благодаря ей мы можем, не выходя из режима конфигурирования, выполнять эти самые команды, просто добавляя перед ними `do`. Примерно так:
`Router(config)# do show running-config`

## Настройка доступа по Telnet
Команда для перехода в **режим конфигурации интерфейса** FastEthernet 0/0:
`Router(config)# interface fa0/0`

По умолчанию все интерфейсы отключены (состояние *administratively down*). Включаем интерфейс:
`Router(config-if)#no shutdown`

Настроим IP-адрес:
`Router(config-if)#ip address 192.168.1.1 255.255.255.0`

*Примечание: shutdown — означает “выключить интерфейс”. Соответственно, если вы хотите отменить действие команды, то используйте слово **`no`** перед ней. Это правило общее для CLI и применимо к большинству команд.*

## Настройка виртуальных терминалов
Подключение по telnet или ssh называется **виртуальным терминалом (vt)** и настраивается следующим образом:

`Router(config)#line vty 0 4`
`Router(config-line)#password cisco`
`Router(config-line)#login`

(`0 4` — это 5 пользовательских виртуальных терминалов=telnet сессий.)

Для доступа в привилегированный режим необходимо настроить пароль для него (режима):

`Router(config)#enable secret test`

(если задавать пароль командой `password`, то следует применить так же `service password-encryption`, тогда ваш пароль в конфигурационном файле будет зашифрован)

Сейчас принятно настраивать доступы не через виртуальные терминалы, а командами `#username` и `#aaa new-model`. В версии PT 5.3.2 они уже есть и вполне работают.
Для этого нужно выполнить:

```
Router(config)#aaa new-model
Router(config)#username admin password 1234
```

Первая команда служит для активации новой модели `ААА (Authentication, Authorization, Accounting)`. Это нужно для того, чтобы была возможность использовать для аунтетификации на устройстве RADIUS или TACACS сервер. Если отдельно это не настроено, то будет использоваться локальная база пользователей, задаваемая командой username. 

**Будьте внимательны:** приоритет команды `aaa new-model` выше, чем команд виртуальных терминалов и поэтому даже несмотря на то, что у вас настроен password в режиме line vty, если у вас не будет пользователей в локальной базе, зайти на устройство удалённо уже не получится.

*Совет:* При работе с access-list'ами и прочими опасными вещами, неправильная настройка которых может лишить вас доступа к устройству, можно использовать замечательную команду `reload in min`, где `min` время в минутах. Эта команда перезагрузит устройство по истечении указанного времени, если ее не прервать командой `reload cancel`.

## Пароль на консольный порт
Если вы хотите ограничить паролем доступ через консольный порт, вам понадобятся команды

```
Router(config)#line console 0
Router(config-line)#login
Router(config-line)#password cisco
```

## SSH
```
Router(config)#hostname R0
R0(config)#ip domain-name cisco-dmn
R0(config)#crypto key generate rsa
R0(config)#line vty 0 4
R0(config-line)#transport input ssh
```

Имя хоста должно отличаться от *Router*, обязательно должно быть задано имя домена. Третьей строкой генерируется ключ и далее разрешается только ssh. Длина ключа должна быть более 768 бит, если вы желаете использовать ssh версии 2, а вы желаете этого. Всё.

Ещё одно финальное внимание новичкам: не забывайте о команде `write memory` — это сохранение текущей конфигурации. Впрочем, достаточно два раза обжечься, забыв сохранить, чтобы навсегда заработать иммунитет к этому — кто кодил по ночам или писал курсовую, тот поймёт.

## Сброс пароля
Требует физического наличия девайса и некоторых навыков/знаний. Подробности в [источнике](http://linkmeup.ru/blog/12.html).