# Коммутация
Важные определения:

* **СКС** — структурированная кабельная система. На деле это все провода, розетки, патчпанели и патчкорды, то есть грубо говоря, это физика вашей сети в узком смысле, в широком — это совокупность сетей: ЛВС, телефонные сети, системы видеонаблюдения и прочее.

* **ЛВС** = Локальная Вычислительная Сеть = **LAN** = Local Area Network. Буржуйский термин более универсален и даёт более простое представление о своём значении.

IP-адреса бывают публичными (уникальными на весь мир) и приватными (доступными для использования в локальных сетях).

Публичные IP-адреса распределяются силами организации IANA (Internet Assigned Numbers Authority).

Приватные IP-адреса никто не контроллирует и они находится в следующих диапазонах:
* 10.0.0.0 — 10.255.255.255
* 172.16.0.0 — 172.31.255.255
* 192.168.0.0 — 192.168.255.255

Они выбраны из каждого класса сети, но сама идея классовости сети уже умерла.

**Широковещательный домен** — область сети, в которой происходит обмен широковещательными сообщениями, и устройства могут отправлять друг другу сообщения непосредственно, без участия маршрутизатора.

Широковещательный домен ограничен маршрутизатором.

Также VLAN ограничивает широкое вещание: только устройства одного VLAN буду в одном широковещательном домене.

Коммутатор работает с канальным уровнем, т.е. работает с MAC-адресами.

## 802.1Q
При включении стандарта 802.1Q (VLAN, тегирование), в кадре появляется новая запись о необходимых данных для работы с виртуальными сетями. Например, номер VLAN.

Также существует Native VLAN (обычно 1-й, можно переопределить), в котором кадры нетегируются (к ним не добавляется вышеупомянутая запись).

Также коммутаторы начинают хранить не только MAC-адрес конечного узла, но и его vlan.

Есть два типа портов:
* Access port -- направлены в сторону конечного устройства. На кадры от них (на коммутаторе) вешается тег, на кадры к ним -- снимается.

* Trunk port -- применяется для связи коммутатор-коммутатор и коммутатор-маршрутизатор для передачи тегированных кадров. Native VLAN передается без тега для поддержки совместимости.

## Access Port
Настройка порта:
```
Switch0#interface fa0/1
Switch0(config)#description “I am using simple frames”
Switch0(config-if)#switchport mode access
Switch0(config-if)#switchport access vlan 2
```

## Trunk Port
Настройка порта:
```
Switch(config)#interface fa0/2
Switch(config-if)#description “I am using tagged frames”
Switch(config-if)#switchport mode trunk
```

Изменение VLAN-ов:
```
msk-arbat-asw3(config-if)#switchport trunk allowed vlan 2,101-104
```

Добавление нового VLAN:
```
msk-arbat-dsw1(config-if)#switchport trunk allowed vlan add 105
```

## Полезные FAQ
* Q: Что произойдёт, если тегированный кадр прилетит на access-порт? 
* A: Он будет отброшен.
---
* Q: Что произойдёт, если нетегированный кадр прилетит на trunk-порт?
* A: Он будет помещён в Native VLAN. По умолчанию им является 1-й VLAN. Но вы можете поменять его командой switchport trunk native vlan 2
В этом случае все кадры, помеченные 2-м вланом будут уходить в этот порт нетегироваными, а нетегированные кадры, приходящий на этот интерфейс, помечаться 2-м вланом.
Кадры с тегами других вланов останутся неизменными, проходя, через такой порт.
---
* Q: Можно ли конечным узлам (компьютерам, ноутбукам, планшетам, телефонам) отправлять тегированные кадры и соответственно подключать их к транковым портам?
* A: Да, можно. Если сетевая карта и программное обеспечение поддерживает стандарт 802.1q, то узел может работать с тегированными кадрами.
---
* Q: Что будет с тегированными кадрами, если они попадут на обычный неуправляемый коммутатор или другое устройство, не понимающее стандарт 802.1q?
* A: Скорее всего, свич его отбросит из-за увеличенного размера кадра. Зависит от разных факторов: производитель, софт (прошивка), тип форвардинга (cut-through, store-and-forward).



## Ссылки для чтения
* [Частный IP-адрес](https://ru.wikipedia.org/wiki/%D0%A7%D0%B0%D1%81%D1%82%D0%BD%D1%8B%D0%B9_IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81)
* [Адресация в IP-сетях](http://citforum.ru/nets/ip/glava_3.shtml)